# 录制文件重命名工具使用说明

## 功能说明

`rename_recording.py` 是一个用于重命名录制文件的工具，可以将录制系统生成的简单文件名重命名为包含用户信息、动作编码和死亡状态的详细文件名。

## 使用方法

### 基本语法
```bash
python rename_recording.py --user <用户名> --f <录制目录名>
```

### 参数说明
- `--user`: 用户名（如：zf）
- `--f`: 录制目录名（如：recording_1761098154）

### 使用示例
```bash
python rename_recording.py --user zf --f recording_1761098154
```

## 重命名规则

### 文件命名格式
```
{user}_f{frame_id}_a{action_code}_nt{death_status}.png
```

### 命名规则说明
- `{user}`: 用户名（如：zf）
- `f{frame_id}`: 帧编号，整数格式（如：f340，不是f000340）
- `a{action_code}`: 动作编码（如：a6）
- `nt{death_status}`: 死亡状态（nt1=存活，nt0=死亡）

### 命名示例
- `zf_f340_a6_nt1.png` - 用户zf，第340帧，右跳(6)，存活
- `zf_f341_a0_nt0.png` - 用户zf，第341帧，无动作(0)，死亡
- `zf_f342_a9_nt1.png` - 用户zf，第342帧，加速左跑(9)，存活

## 动作编码对照表

| 动作 | 编码值 | 示例组合 |
|------|--------|----------|
| 向左移动 | 1 | 左跳 = 1+4 = 5 |
| 向右移动 | 2 | 右跳 = 2+4 = 6 |
| 跳跃 | 4 | 加速左跑 = 1+8 = 9 |
| 动作/加速/火球 | 8 | 加速右跳 = 2+4+8 = 14 |
| 蹲下 | 16 | 蹲下左移 = 1+16 = 17 |

## 操作流程

1. **检查目录**: 验证录制目录是否存在
2. **加载数据**: 读取 `recording_data.json` 文件
3. **显示示例**: 展示前几帧的数据信息
4. **确认操作**: 用户确认是否继续重命名
5. **重命名文件**: 按照新规则重命名所有帧图片
6. **更新JSON**: 更新JSON文件中的文件名信息

## 输出示例

```
用户: zf
录制目录: recordings/recording_1761098154
==================================================
加载录制数据...
找到 1500 帧数据

示例数据:
  帧 0: action=6, dead=False
  帧 1: action=2, dead=False
  帧 2: action=0, dead=False

准备重命名 1500 个文件
是否继续? (y/N): y

开始重命名...
重命名: frame_000000.png -> zf_f0_a6_nt1.png
重命名: frame_000001.png -> zf_f1_a2_nt1.png
重命名: frame_000002.png -> zf_f2_a0_nt1.png
...

重命名完成!
成功: 1500 个文件
失败: 0 个文件

更新JSON文件...
JSON文件已更新: recordings/recording_1761098154/recording_data.json

✅ 重命名完成!
```

## 注意事项

1. **备份数据**: 建议在重命名前备份原始录制数据
2. **目录结构**: 确保录制目录包含 `frames/` 子目录和 `recording_data.json` 文件
3. **权限问题**: 确保有足够的文件读写权限
4. **文件名冲突**: 如果目标文件名已存在，重命名会失败
5. **帧编号格式**: 帧编号使用整数格式（如：f340），不保留前导零

## 错误处理

- 如果录制目录不存在，程序会报错并退出
- 如果JSON文件损坏或格式错误，程序会报错并退出
- 如果某个文件重命名失败，程序会继续处理其他文件
- 所有错误都会在控制台显示详细信息

## 技术细节

- 使用 `os.rename()` 进行文件重命名
- 支持UTF-8编码的JSON文件
- 自动更新JSON文件中的文件名引用
- 添加用户信息和命名格式到JSON元数据中
